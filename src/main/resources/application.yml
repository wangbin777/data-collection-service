spring:
  application:
    name: data-collection-service
  profiles:
    active: dev
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/data_collection?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: wangbin@123
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  data:
    redis:
      host: 43.138.73.155
      port: 6739
      database: 0
      timeout: 3000
      password: wangbin@123
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
          max-wait: -1
        shutdown-timeout: 100ms
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Shanghai
    serialization:
      write-dates-as-timestamps: false
  task:
    execution:
      pool:
        core-size: 10
        max-size: 50
        queue-capacity: 1000
        keep-alive: 60s
      thread-name-prefix: async-task-

collector:
  #自适应采集配置
  adaptive-collection:
    enabled: true          # 自适应采集开关，默认开启
    adjust-window-ms: 60000 # 调整窗口，默认1分钟
  #采集任务调度配置
  scheduler:
    # 初始时间片数量：调度器启动时分配给每个任务的时间片数量
    initial-time-slice-count: 4
    # 最大时间片数量：每个任务最多可以获得的时间片数量上限
    max-time-slice-count: 12
    # 最小时间片间隔（毫秒）：两个时间片之间的最小时间间隔，防止过度频繁调度
    min-time-slice-interval-ms: 300
    # 默认时间片间隔（毫秒）：默认情况下时间片的时间长度
    default-time-slice-interval-ms: 1500
    # 初始时间片间隔（毫秒）：调度器启动时使用的时间片间隔
    initial-time-slice-interval-ms: 1500
    # 动态调整间隔（毫秒）：调度器动态调整时间片分配策略的时间间隔
    dynamic-adjust-interval-ms: 60000
    # 收集超时时间（毫秒）：等待任务执行结果或状态收集的最大等待时间
    collect-timeout-ms: 800

  config:
    yun-url: http://localhost:48080
    sync-interval: 30000
    service-id: collector-1
    tenant-id: 1
    api-token: ""

  cache:
    type: local
    local:
      max-size: 10000
      expire-after-write: 300
      expire-after-access: 60
      initial-capacity: 1000
    redis:
      key-prefix: "collector:cache:"
      default-expire: 3600
      connection-timeout: 3000

  report:
    enabled: true
    mode: mqtt
    batch-size: 100
    intervalMs: 1000
    timeout: 3000
    retry-times: 3
    max-queue-size: 5000
    flush-interval: 1000
    mqtt:
      enabled: true
      broker-url: tcp://43.138.73.155:1883
      client-id: byxuTQjqn6TCDwJ0.collector-1
      username: collector-1&byxuTQjqn6TCDwJ0
      password: 99689a00383882f4566ab8dc5e49dc895d6c5afb56055c860e6774aa2e14bab8
      topic-prefix: iot/device
      ack-topic-prefix: /sys
      gateway-product-key: byxuTQjqn6TCDwJ0
      gateway-device-name: collector-1
      ack-topic-suffix: _reply
      ack-timeout-seconds: 5
      qos: 1
      clean-session: true
      connection-timeout: 30
      keep-alive-interval: 60
      topics:
        property: thing/property/post
        event: thing/event/post
        state: thing/state/update


  modbus:
    timeout: 3000
    retries: 2
    pool-size: 10

  opc-ua:
    security-policy: None
    message-mode: Binary
    request-timeout: 5000
    subscription-interval: 1000
    endpoints:
      server1: opc.tcp://localhost:4840
      server2: opc.tcp://192.168.1.200:4840

  iec104:
    timeout: 5000
    retries: 3
    common-address: 1
    general-interrogation-on-connect: true
    general-interrogation-interval: 600000
    single-interrogation-on-read-miss: true
    single-interrogation-group-field: groupId
    cache-ttl: 5000

  snmp:
    community: public
    timeout: 3000
    retries: 2
    version: 2c
    polling-interval: 5000
    devices:
      device1: 192.168.1.100
      device2: 192.168.1.101

  mqtt:
    broker-url: tcp://localhost:1883
    client-id: data-collector
    username: admin
    password: password
    qos: 1
    clean-session: true
    connection-timeout: 30
    keep-alive-interval: 60

mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.wangbin.collector.common.domain.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

logging:
  level:
    com.wangbin.collector: INFO
    org.springframework: INFO
    org.springframework.web: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/collector.log
    max-size: 10MB
    max-history: 30

server:
  port: 9090
  servlet:
    context-path: /collector
  shutdown: graceful
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
    min-response-size: 2048
  tomcat:
    max-threads: 200
    min-spare-threads: 20
    connection-timeout: 5000
    accept-count: 100

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  prometheus:
    metrics:
      export:
        enabled: true
